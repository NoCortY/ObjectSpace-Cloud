<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.objectspace.componentcenter.dao.ComponentDao">
    <!--开启本mapper的namespace下的二级缓存-->
    <!--
        eviction:代表的是缓存回收策略，目前MyBatis提供以下策略。
        (1) LRU,最近最少使用的，一处最长时间不用的对象
        (2) FIFO,先进先出，按对象进入缓存的顺序来移除他们
        (3) SOFT,软引用，移除基于垃圾回收器状态和软引用规则的对象
        (4) WEAK,弱引用，更积极的移除基于垃圾收集器状态和弱引用规则的对象。
        	这里采用的是LRU，  移除最长时间不用的对形象

        flushInterval:刷新间隔时间，单位为毫秒，如果你不配置它，那么当
        SQL被执行的时候才会去刷新缓存。

        size:引用数目，一个正整数，代表缓存最多可以存储多少个对象，不宜设置过大。设置过大会导致内存溢出。
        这里配置的是1024个对象

        readOnly:只读，意味着缓存数据只能读取而不能修改，这样设置的好处是我们可以快速读取缓存，缺点是我们没有
        办法修改缓存，他的默认值是false，不允许我们修改
    -->
    <cache eviction="LRU" type="cn.objectspace.common.cache.MyBatisCache"/>
    <insert id="insertCloudServer" parameterType="CloudServer">
        INSERT INTO cloud_server
        <trim prefix="(" suffix=")" prefixOverrides=",">
            <if test="serverIp!=null and serverIp!=''">
                server_ip,
            </if>
            <if test="serverName!=null and serverName!=''">
                server_name,
            </if>
            <if test="serverOsType!=null and serverOsType!=''">
                server_os_type,
            </if>
            <if test="serverOsVersion!=null and serverOsVersion!=''">
                server_os_version,
            </if>
            <if test="isMonitor!=null">
                is_monitor,
            </if>
            <if test="serverUser!=null">
                server_user
            </if>
        </trim>
        VALUES
        <trim prefix="(" suffix=")" prefixOverrides=",">
            <if test="serverIp!=null and serverIp!=''">
                #{serverIp},
            </if>
            <if test="serverName!=null and serverName!=''">
                #{serverName},
            </if>
            <if test="serverOsType!=null and serverOsType!=''">
                #{serverOsType},
            </if>
            <if test="serverOsVersion!=null and serverOsVersion!=''">
                #{serverOsVersion},
            </if>
            <if test="isMonitor!=null">
                #{isMonitor},
            </if>
            <if test="serverUser!=null">
                #{serverUser}
            </if>
        </trim>
    </insert>
    <select id="queryServerByUserIdAndServerIp" resultType="CloudServer">
        SELECT
        server_ip,
        server_name,
        server_os_type,
        server_os_version,
        is_monitor
        FROM
        cloud_server
        <where>
            server_user=#{userId} and server_ip = #{serverIp}
        </where>
    </select>
    <select id="queryServerByUserId" parameterType="java.lang.Integer" resultType="CloudServer">
        SELECT
        server_ip,
        server_name ,
        server_os_type,
        server_os_version,
        is_monitor
        FROM
        cloud_server
        <where>
            server_user = #{userId}
        </where>
    </select>

    <insert id="insertServerStateInfo" parameterType="ServerInfoDto">
        INSERT INTO cloud_server_info_now
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="computerName!=null and computerName!=''">
                computer_name,
            </if>
            <if test="userDomain!=null and userDomain!=''">
                user_domain,
            </if>
            <if test="ip!=null and ip!=''">
                ip,
            </if>
            <if test="osName!=null and osName!=''">
                os_name,
            </if>
            <if test="osArch!=null and osArch!=''">
                os_arch,
            </if>
            <if test="osVersion!=null and osVersion!=''">
                os_version,
            </if>
            <if test="memTotal!=null">
                mem_total,
            </if>
            <if test="memUsed!=null">
                mem_used,
            </if>
            <if test="memFree!=null">
                mem_free,
            </if>
            <if test="swapFree!=null">
                swap_free,
            </if>
            <if test="swapUsedPercent!=null">
                swap_used_percent,
            </if>
            <if test="serverUser!=null">
                server_user,
            </if>
            <if test="recordTime!=null">
                record_time
            </if>
        </trim>
        VALUES
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="computerName!=null and computerName!=''">
                #{computerName},
            </if>
            <if test="userDomain!=null and userDomain!=''">
                #{userDomain},
            </if>
            <if test="ip!=null and ip!=''">
                #{ip},
            </if>
            <if test="osName!=null and osName!=''">
                #{osName},
            </if>
            <if test="osArch!=null and osArch!=''">
                #{osArch},
            </if>
            <if test="osVersion!=null and osVersion!=''">
                #{osVersion},
            </if>
            <if test="memTotal!=null">
                #{memTotal},
            </if>
            <if test="memUsed!=null">
                #{memUsed},
            </if>
            <if test="memFree!=null">
                #{memFree},
            </if>
            <if test="swapFree!=null">
                #{swapFree},
            </if>
            <if test="swapUsedPercent!=null">
                #{swapUsedPercent},
            </if>
            <if test="serverUser!=null">
                #{serverUser},
            </if>
            <if test="recordTime!=null">
                #{recordTime}
            </if>
        </trim>
    </insert>
    <insert id="insertCpuStateInfo" parameterType="CpuDto">
            INSERT INTO cloud_cpu_info_now(
                cpu_id,

                    cpu_server_ip,
                    cpu_server_user,
                    frequency,
                    vendor,
                    model,
                    user_used,
                    system_used,
                    combine,
                    idle,
                    record_time)
            VALUES
        <foreach collection ="list" item="cpu" index= "index" separator =",">
                (#{index},
                    #{cpu.cpuServerIp},
                    #{cpu.cpuServerUser},
                    #{cpu.frequency},
                    #{cpu.vendor},
                    #{cpu.model},
                    #{cpu.userUsed},
                    #{cpu.systemUsed},
                    #{cpu.combine},
                    #{cpu.idle},
                    #{cpu.recordTime})
        </foreach>
    </insert>
    <insert id="insertDiskStateInfo" parameterType="DiskDto" >
            INSERT INTO cloud_disk_info_now(
                    disk_server_ip,
                    disk_server_user,
                    disk_name,
                    disk_type,
                    total,
                    free,
                    avail,
                    used,
                    use_percent,
                    read_disk,
                    write_disk,
                    record_time)
            VALUES

        <foreach collection="list" index="index" item="disk"  separator =",">
                    (#{disk.diskServerIp},
                    #{disk.diskServerUser},
                    #{disk.diskName},
                    #{disk.diskType},
                    #{disk.total},
                    #{disk.free},
                    #{disk.avail},
                    #{disk.used},
                    #{disk.usePercent},
                    #{disk.readDisk},
                    #{disk.writeDisk},
                    #{disk.recordTime})
        </foreach>
    </insert>
    <insert id="insertNetStateInfo" parameterType="NetDto">
            INSERT INTO cloud_net_info_now(
                    net_server_ip,
                    net_server_user,
                    net_name,
                    net_ip,
                    net_mask,
                    rx_packets,
                    tx_packets,
                    rx_bytes,
                    tx_bytes,
                    rx_errors,
                    tx_errors,
                    rx_dropped,
                    tx_dropped,
                    record_time)
            VALUES

        <foreach collection="list" item="net" index="index"  separator =",">
            (
            #{net.netServerIp},
            #{net.netServerUser},
            #{net.netName},
            #{net.netIp},
            #{net.netMask},
            #{net.rxPackets},
            #{net.txPackets},
            #{net.rxBytes},
            #{net.txBytes},
            #{net.rxErrors},
            #{net.txErrors},
            #{net.rxDropped},
            #{net.txDropped},
            #{net.recordTime}
            )
        </foreach>
    </insert>
    <!--<insert id="insertComponent">
        INSERT INTO cloud_microservice
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="applicationName!=null and applicationName!=''">
                application_name,
            </if>
            <if test="applicationPassword!=null and applicationPassword!=''">
                application_password,
            </if>
            <if test="applicationJarName!=null and applicationJarName!=''">
                application_jar_name,
            </if>
            <if test="applicationLocation!=null and applicationLocation!=''">
                application_location,
            </if>
            <if test="applicationStarter!=null and applicationStarter!=''">
                application_starter,
            </if>
            <if test="applicationServerIp!=null and applicationServerIp!=''">
                application_server_ip,
            </if>
            <if test="applicationPort!=null and applicationPort!=''">
                application_port,
            </if>
            <if test="applicationDesc!=null and applicationDesc!=''">
                application_desc
            </if>
        </trim>
        VALUES
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="applicationName!=null and applicationName!=''">
                #{applicationName},
            </if>
            <if test="applicationPassword!=null and applicationPassword!=''">
                #{applicationPassword},
            </if>
            <if test="applicationJarName!=null and applicationJarName!=''">
                #{applicationJarName},
            </if>
            <if test="applicationLocation!=null and applicationLocation!=''">
                #{applicationLocation},
            </if>
            <if test="applicationStarter!=null and applicationStarter!=''">
                #{applicationStarter},
            </if>
            <if test="applicationServerIp!=null and applicationServerIp!=''">
                #{applicationServerIp},
            </if>
            <if test="applicationPort!=null and applicationPort!=''">
                #{applicationPort},
            </if>
            <if test="applicationDesc!=null and applicationDesc!=''">
                #{applicationDesc}
            </if>
        </trim>
    </insert>-->
</mapper>